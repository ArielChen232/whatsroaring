{"ast":null,"code":"import _classCallCheck from \"/Users/clairedu/Desktop/College/cos333/calendar_project/whatsroaring/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\n\nvar CASClient = function CASClient() {\n  var _this = this;\n\n  _classCallCheck(this, CASClient);\n\n  this.casURL = 'https://fed.princeton.edu/cas/';\n\n  this.validate = function (ticket, callback) {\n    var val_url = _this.casURL + 'validate?service=' + encodeURIComponent(_this.serviceURL()) + '&ticket=' + encodeURIComponent(ticket);\n    console.log('validate url = ' + val_url);\n    $.ajax({\n      method: 'GET',\n      url: val_url,\n      success: function success(res) {\n        var netid = null;\n        lines = res.responseText;\n        callback(lines);\n      }\n    }); // fetch(val_url)\n    //   .then(resp => {\n    //     console.log('url opened')\n    //     var netid = null\n    //     resp.text().then(function (text) {\n    //       text = text.split(\"\\n\")\n    //       if (text[0] == 'yes') {\n    //         netid = text[1]\n    //         console.log('validated netid: ' + netid)\n    //       }\n    //       callback(netid)\n    //     })\n    //   })\n    // var request = new XMLHttpRequest();\n    // request.open('GET', val_url, true);\n    // request.send();\n    // request.onreadystatechange = function () {\n    //   console.log('url opened')\n    //   if (request.readyState === 4 && request.status === 200) {\n    //     var netid = null\n    //     var lines = request.responseText;\n    //     lines = lines.split(\"\\n\")\n    //     if (lines[0] == 'yes') {\n    //       netid = lines[1]\n    //       console.log('validated netid: ' + netid)\n    //     }\n    //     callback(netid)\n    //   }\n    // }\n  };\n\n  this.authenticate = function (callback) {\n    // if username is stored, then user was already authenticated\n    var netid = localStorage.getItem('netid');\n    console.log('netid: ' + netid);\n\n    if (netid != null) {\n      callback();\n      return;\n    } // if request has a login ticket, try to validate it\n\n\n    var urlParams = new URLSearchParams(window.location.search);\n    var ticket = urlParams.get('ticket');\n    console.log('ticket: ' + ticket);\n\n    if (ticket) {\n      console.log('ticket received');\n\n      _this.validate(ticket, function (netid) {\n        if (netid != null) {\n          console.log('set netid to: ' + netid); // set netid in storage\n\n          localStorage.setItem('netid', netid);\n          callback();\n          return;\n        }\n      });\n    } // No valid ticket; redirect the browser to the login page to get one\n\n\n    console.log('no ticket found');\n    var login_url = _this.casURL + 'login?service=' + encodeURIComponent(_this.serviceURL());\n    console.log('Location: ' + login_url);\n    window.location.href = login_url;\n    return;\n  };\n\n  this.serviceURL = function () {\n    var url = window.location.href; // Remove the \"ticket\" parameter from the URL.\n\n    url = url.split(\"?\")[0]; // Remove a trailing question mark and/or ampersand.\n\n    url = url.replace(\"\\\\?&?$|&$\", \"\");\n    console.log('url:' + url);\n    return url;\n  };\n};\n\nexport { CASClient as default };","map":{"version":3,"sources":["/Users/clairedu/Desktop/College/cos333/calendar_project/whatsroaring/src/Pages/CASClient.js"],"names":["React","Component","withRouter","CASClient","casURL","validate","ticket","callback","val_url","encodeURIComponent","serviceURL","console","log","$","ajax","method","url","success","res","netid","lines","responseText","authenticate","localStorage","getItem","urlParams","URLSearchParams","window","location","search","get","setItem","login_url","href","split","replace"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,UAAT,QAA2B,kBAA3B;;IAEqBC,S;;;;;OACnBC,M,GAAS,gC;;OAETC,Q,GAAW,UAACC,MAAD,EAASC,QAAT,EAAsB;AAC/B,QAAMC,OAAO,GAAI,KAAI,CAACJ,MAAL,GAAc,mBAAd,GACbK,kBAAkB,CAAC,KAAI,CAACC,UAAL,EAAD,CADL,GAC2B,UAD3B,GAEbD,kBAAkB,CAACH,MAAD,CAFtB;AAGAK,IAAAA,OAAO,CAACC,GAAR,CAAY,oBAAoBJ,OAAhC;AACAK,IAAAA,CAAC,CAACC,IAAF,CAAO;AACLC,MAAAA,MAAM,EAAE,KADH;AAELC,MAAAA,GAAG,EAAER,OAFA;AAGLS,MAAAA,OAAO,EAAE,iBAACC,GAAD,EAAS;AAChB,YAAIC,KAAK,GAAG,IAAZ;AACAC,QAAAA,KAAK,GAAGF,GAAG,CAACG,YAAZ;AACAd,QAAAA,QAAQ,CAACa,KAAD,CAAR;AACD;AAPI,KAAP,EAL+B,CAc/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD,G;;OAEDE,Y,GAAe,UAACf,QAAD,EAAc;AAC3B;AACA,QAAIY,KAAK,GAAGI,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAZ;AACAb,IAAAA,OAAO,CAACC,GAAR,CAAY,YAAaO,KAAzB;;AACA,QAAIA,KAAK,IAAI,IAAb,EAAmB;AACjBZ,MAAAA,QAAQ;AACR;AACD,KAP0B,CAS3B;;;AACA,QAAMkB,SAAS,GAAG,IAAIC,eAAJ,CAAoBC,MAAM,CAACC,QAAP,CAAgBC,MAApC,CAAlB;AACA,QAAMvB,MAAM,GAAGmB,SAAS,CAACK,GAAV,CAAc,QAAd,CAAf;AACAnB,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAaN,MAAzB;;AACA,QAAIA,MAAJ,EAAY;AACVK,MAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ;;AACA,MAAA,KAAI,CAACP,QAAL,CAAcC,MAAd,EAAsB,UAASa,KAAT,EAAgB;AACpC,YAAIA,KAAK,IAAI,IAAb,EAAmB;AACjBR,UAAAA,OAAO,CAACC,GAAR,CAAY,mBAAmBO,KAA/B,EADiB,CAEjB;;AACAI,UAAAA,YAAY,CAACQ,OAAb,CAAqB,OAArB,EAA8BZ,KAA9B;AACAZ,UAAAA,QAAQ;AACR;AACD;AACF,OARD;AASD,KAxB0B,CAyB3B;;;AACAI,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ;AACA,QAAIoB,SAAS,GAAG,KAAI,CAAC5B,MAAL,GAAc,gBAAd,GAAiCK,kBAAkB,CAAC,KAAI,CAACC,UAAL,EAAD,CAAnE;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAY,eAAeoB,SAA3B;AACAL,IAAAA,MAAM,CAACC,QAAP,CAAgBK,IAAhB,GAAuBD,SAAvB;AACA;AACD,G;;OAEDtB,U,GAAa,YAAM;AACjB,QAAIM,GAAG,GAAGW,MAAM,CAACC,QAAP,CAAgBK,IAA1B,CADiB,CAEjB;;AACAjB,IAAAA,GAAG,GAAGA,GAAG,CAACkB,KAAJ,CAAU,GAAV,EAAe,CAAf,CAAN,CAHiB,CAIjB;;AACAlB,IAAAA,GAAG,GAAGA,GAAG,CAACmB,OAAJ,CAAY,WAAZ,EAAyB,EAAzB,CAAN;AACAxB,IAAAA,OAAO,CAACC,GAAR,CAAY,SAASI,GAArB;AACA,WAAOA,GAAP;AACD,G;;;SAzFkBb,S","sourcesContent":["import React, { Component } from 'react'\nimport { withRouter } from 'react-router-dom'\n\nexport default class CASClient {\n  casURL = 'https://fed.princeton.edu/cas/'\n\n  validate = (ticket, callback) => {\n    const val_url = (this.casURL + 'validate?service=' +\n        encodeURIComponent(this.serviceURL()) + '&ticket=' +\n        encodeURIComponent(ticket))\n    console.log('validate url = ' + val_url)\n    $.ajax({\n      method: 'GET',\n      url: val_url,\n      success: (res) => {\n        var netid = null\n        lines = res.responseText\n        callback(lines)\n      }\n    })\n    // fetch(val_url)\n    //   .then(resp => {\n    //     console.log('url opened')\n    //     var netid = null\n    //     resp.text().then(function (text) {\n    //       text = text.split(\"\\n\")\n    //       if (text[0] == 'yes') {\n    //         netid = text[1]\n    //         console.log('validated netid: ' + netid)\n    //       }\n    //       callback(netid)\n    //     })\n    //   })\n    // var request = new XMLHttpRequest();\n    // request.open('GET', val_url, true);\n    // request.send();\n    // request.onreadystatechange = function () {\n    //   console.log('url opened')\n    //   if (request.readyState === 4 && request.status === 200) {\n    //     var netid = null\n    //     var lines = request.responseText;\n    //     lines = lines.split(\"\\n\")\n    //     if (lines[0] == 'yes') {\n    //       netid = lines[1]\n    //       console.log('validated netid: ' + netid)\n    //     }\n    //     callback(netid)\n    //   }\n    // }\n  }\n\n  authenticate = (callback) => {\n    // if username is stored, then user was already authenticated\n    var netid = localStorage.getItem('netid')\n    console.log('netid: ' +  netid)\n    if (netid != null) {\n      callback()\n      return\n    }\n\n    // if request has a login ticket, try to validate it\n    const urlParams = new URLSearchParams(window.location.search);\n    const ticket = urlParams.get('ticket');\n    console.log('ticket: ' + ticket)\n    if (ticket) {\n      console.log('ticket received')\n      this.validate(ticket, function(netid) {\n        if (netid != null) {\n          console.log('set netid to: ' + netid)\n          // set netid in storage\n          localStorage.setItem('netid', netid)\n          callback()\n          return\n        }\n      })\n    }\n    // No valid ticket; redirect the browser to the login page to get one\n    console.log('no ticket found')\n    var login_url = this.casURL + 'login?service=' + encodeURIComponent(this.serviceURL())\n    console.log('Location: ' + login_url)\n    window.location.href = login_url\n    return\n  }\n\n  serviceURL = () => {\n    var url = window.location.href;\n    // Remove the \"ticket\" parameter from the URL.\n    url = url.split(\"?\")[0];\n    // Remove a trailing question mark and/or ampersand.\n    url = url.replace(\"\\\\?&?$|&$\", \"\");\n    console.log('url:' + url)\n    return url;\n  }\n\n}\n"]},"metadata":{},"sourceType":"module"}